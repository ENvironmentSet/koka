
<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>std/async documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<h1><a class="link" href="std_async-source.html"><span class="mo">std<span class="fslash">/</span>async</span></a><a class="link" href="toc.html"><span class="toc-link">&#x25b2;toc</span></a></h1>
<div class="toc code"><ul class="toc"><li><a class="link" href="#type_space_async"><span class="kw">type</span>&nbsp;<span class="tp">async</span></a>
</li><li><a class="link" href="#type_space_asyncx"><span class="kw">alias</span>&nbsp;<span class="tp">asyncx</span></a>
</li><li><a class="link" href="#type_space_channel"><span class="kw">type</span>&nbsp;<span class="tp">channel</span></a>
</li><li class="nested"><a class="link" href="#await_to_channel"><span class="kw">fun</span>&nbsp;await<span class="dash">-</span>to<span class="dash">-</span>channel</a></li><li class="nested"><a class="link" href="#channel"><span class="kw">fun</span>&nbsp;channel</a></li><li class="nested"><a class="link" href="#emit"><span class="kw">fun</span>&nbsp;emit</a></li><li class="nested"><a class="link" href="#receive"><span class="kw">fun</span>&nbsp;receive</a></li><li class="nested"><a class="link" href="#try_receive_ques_"><span class="kw">fun</span>&nbsp;try<span class="dash">-</span>receive?</a></li><li><a class="link" href="#type_space_channel_state"><span class="kw">type</span>&nbsp;<span class="tp">channel<span class="dash">-</span>state</span></a>
</li><li><a class="link" href="#type_space_promise"><span class="kw">type</span>&nbsp;<span class="tp">promise</span></a>
</li><li class="nested"><a class="link" href="#await"><span class="kw">fun</span>&nbsp;await</a></li><li class="nested"><a class="link" href="#promise"><span class="kw">fun</span>&nbsp;promise</a></li><li class="nested"><a class="link" href="#resolve"><span class="kw">fun</span>&nbsp;resolve</a></li></ul><ul class="toc"><li class="nested"><a class="link" href="#try_await"><span class="kw">fun</span>&nbsp;try<span class="dash">-</span>await</a></li><li><a class="link" href="#type_space_promise_state"><span class="kw">type</span>&nbsp;<span class="tp">promise<span class="dash">-</span>state</span></a>
</li><li><a class="link" href="#type_space_scope"><span class="kw">type</span>&nbsp;<span class="tp">scope</span></a>
</li><li class="nested"><a class="link" href="#cancel"><span class="kw">fun</span>&nbsp;cancel</a></li><li><a class="link" href="#type_space_timeout_id"><span class="kw">type</span>&nbsp;<span class="tp">timeout<span class="dash">-</span>id</span></a>
</li><li>&nbsp;</li><li><a class="link" href="#async_handle"><span class="kw">fun</span>&nbsp;async<span class="dash">-</span>handle</a></li><li><a class="link" href="#async_iox"><span class="kw">fun</span>&nbsp;async<span class="dash">-</span>iox</a></li><li><a class="link" href="#await_exn"><span class="kw">fun</span>&nbsp;await<span class="dash">-</span>exn</a></li><li><a class="link" href="#await_exn0"><span class="kw">fun</span>&nbsp;await<span class="dash">-</span>exn0</a></li><li><a class="link" href="#await_exn1"><span class="kw">fun</span>&nbsp;await<span class="dash">-</span>exn1</a></li><li><a class="link" href="#await_1"><span class="kw">fun</span>&nbsp;await</a></li><li><a class="link" href="#await0"><span class="kw">fun</span>&nbsp;await0</a></li></ul><ul class="toc"><li><a class="link" href="#await1"><span class="kw">fun</span>&nbsp;await1</a></li><li><a class="link" href="#cancel_1"><span class="kw">fun</span>&nbsp;cancel</a></li><li><a class="link" href="#cancelable"><span class="kw">fun</span>&nbsp;cancelable</a></li><li><a class="link" href="#do_await"><span class="kw">fun</span>&nbsp;do<span class="dash">-</span>await</a></li><li><a class="link" href="#interleaved"><span class="kw">fun</span>&nbsp;interleaved</a></li><li><a class="link" href="#interleaved_1"><span class="kw">fun</span>&nbsp;interleaved</a></li><li><a class="link" href="#interleavedx"><span class="kw">fun</span>&nbsp;interleavedx</a></li><li><a class="link" href="#interleavedx_1"><span class="kw">fun</span>&nbsp;interleavedx</a></li><li><a class="link" href="#no_await"><span class="kw">fun</span>&nbsp;no<span class="dash">-</span>await</a></li><li><a class="link" href="#wait"><span class="kw">fun</span>&nbsp;wait</a></li><li><a class="link" href="#wait_1"><span class="kw">fun</span>&nbsp;wait</a></li><li><a class="link" href="#yield"><span class="kw">fun</span>&nbsp;yield</a></li></ul></div>
<div class="doc koka comment">

<p class="p noindent"> Asynchronous primitives
</p>
<p class="p indent">This module is based closely on&nbsp;<span class="citations" style="target-element:bibitem">[<a href="#leijen:async" class="bibref localref" style="target-element:bibitem"><span class="cite-number">1</span></a>]</span> and aims to have robust and composable asynchronous
primitives. In particular, any outstanding asynchronous operation can be canceled (through <code class="koka">cancel</code>)
within a certain scope which allows for composable primitives like <code class="koka">timeout</code> and <code class="koka">firstof</code>.
</p><h3 id="sec-references" class="clearnum h2" data-heading-depth="2" style="display:block">References</h3>
<div class="bibliography" data-hanging-indent="0" style="bibstyle:madoko-numeric">
<div id="leijen:async" class="bibitem" data-cite-label="1" style="text-indent:-2rem;margin-left:2rem;bibitem-label:[1];searchterm:Leijen+Daan+Structured+Asynchrony+with+Algebraic+Effects"><span class="bibitem-before" style="padding-right:0.5em;display: inline-block; width:calc(2rem - 0.5em);display: inline-block; text-align:right;font-size:90%">[1]</span>Daan Leijen.
<em class="em-low1">Structured Asynchrony with Algebraic Effects</em>.
Microsoft Research technical report MSR-TR-2017-21, May 2017.
<a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2017/05/asynceffects-msr-tr-2017-21.pdf">pdf</a>&nbsp;<a href="http://www.bing.com/search?q=Leijen+Daan+Structured+Asynchrony+with+Algebraic+Effects" class="bibsearch">&#128270;</a></div></div>
<p class="p noindent">.
</p></div>
<div class="decl" id="type_space_async"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></span></span><span class="tp"></span></div><div class="doc koka comment">

<p class="p noindent">   Asynchronous operations have the <code class="koka"><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></code> effect.
</p></div></div>
<div class="decl" id="type_space_asyncx"><div class="header code"><span class="def"><span class="kw">alias</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_asyncx"><span class="tp">asyncx</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a></span></span><span class="tp"></span>&nbsp;<span class="kw">=</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   A type alias for asynchronous operations that can raise exceptions non-deterministically.
   This is common for almost all <code class="koka"><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></code> operations since <code class="koka">cancel</code> and <code class="koka">timeout</code> can
   cancel operations non-deterministically which raises the <code class="koka"><span class="co">Cancel</span></code> exception and cancels
   outstanding asynchronous requests.
</p></div></div>
<div class="decl" id="type_space_channel"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a></span></span><span class="tp">&lt;<span class="tp tv">a</span>&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   A <em class="em-low1">channel</em> of values of type <code class="koka"><span class="tp tv">a</span></code>. Values can be asynchronously <code class="koka"><a class="pp" href="#emit">emit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code>ed into
   a channel, and asynchronously <code class="koka"><a class="pp" href="#receive">receive<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>receive: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a></code>d.
</p></div><div class="nested"><div class="decl" id="await_to_channel"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await_to_channel">await<span class="dash">-</span>to<span class="dash">-</span>channel</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <a class="pp" href="std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <span class="tp tpp">ch</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span>, <span class="tp tpp">f</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Primitive: Execute <code class="koka">setup</code> to set up an asynchronous callback with the host platform. Invoke <code class="koka">cb</code> as the callback: it takes either
   an exception or a result value, together with boolean parameter whether the callback is done.
   The callback <code class="koka">cb</code> will eventually emit the result into the given channel <code class="koka">ch</code> after applying the transformation <code class="koka">f</code> to the result.<br>
   Note: once you exit the <code class="koka"><a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span></span></a></code> scope where <code class="koka"><a class="pp" href="#await_to_channel">await<span class="dash">-</span>to<span class="dash">-</span>channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>to<span class="dash">-</span>channel: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">b</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">async</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">b</span><span class="tp sp">&#62;</span></span></a></code> was called, the callback is invoked with a <code class="koka"><span class="co">Cancel</span></code> exception.
   The channel should always be awaited within the same <code class="koka"><a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span></span></a></code> scope as the <code class="koka"><a class="pp" href="#await_to_channel">await<span class="dash">-</span>to<span class="dash">-</span>channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>to<span class="dash">-</span>channel: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">b</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">async</span> <span class="tp">channel</span><span class="tp sp">&#60;</span><span class="tp tv">b</span><span class="tp sp">&#62;</span></span></a></code> invokation.
</p></div></div><div class="decl" id="channel"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#channel">channel</a></span>()<span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Create a new asynchronous channel.
</p></div></div><div class="decl" id="emit"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#emit">emit</a></span>( <span class="tp tpp">ch</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span>, <span class="tp tpp">value</span> <span class="tp sp">:</span>&nbsp;<span class="tp tv">a</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_asyncx"><span class="tp">asyncx</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Emit a value asynchronously into a channel.
</p></div></div><div class="decl" id="receive"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#receive">receive</a></span>( <span class="tp tpp">ch</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_asyncx"><span class="tp">asyncx</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Receive (and remove) a value from the channel: returns immediately if a value is available and otherwise
   waits asynchronously until a value becomes available.
</p></div></div><div class="decl" id="try_receive_ques_"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#try_receive_ques_">try<span class="dash">-</span>receive?</a></span>( <span class="tp tpp">ch</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Return immediately if a value is available on the channel and otherwise returns <code class="koka"><a class="pp" href="std_core.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code>.
</p></div></div></div></div>
<div class="decl" id="type_space_channel_state"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_channel_state"><span class="tp">channel<span class="dash">-</span>state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a></span></span><span class="tp">&lt;<span class="tp tv">a</span>&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   todo: use queue data type for the values and listeners for better complexity.
</p></div></div>
<div class="decl" id="type_space_promise"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a></span></span><span class="tp">&lt;<span class="tp tv">a</span>&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   A <em class="em-low1">promise</em> that carries a value of type <code class="koka"><span class="tp tv">a</span></code>. A promise is initially empty
   but can be <code class="koka">await</code>ed  asynchronously until it gets <code class="koka"><a class="pp" href="#resolve">resolve<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>resolve: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a></code>d unblocking any
   <code class="koka">await</code> operations. After that a promise stays resolved and any <code class="koka">await</code> will
   return immediately. It is an error to try to resolve a promise more than once.
</p></div><div class="nested"><div class="decl" id="await"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await">await</a></span>( <span class="tp tpp">p</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_asyncx"><span class="tp">asyncx</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Await a promise; returns immediately if the promise was already resolved and otherwise
   waits asynchronously.
</p></div></div><div class="decl" id="promise"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#promise">promise</a></span>()<span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Create a new promise.
</p></div></div><div class="decl" id="resolve"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#resolve">resolve</a></span>( <span class="tp tpp">p</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span>, <span class="tp tpp">value</span> <span class="tp sp">:</span>&nbsp;<span class="tp tv">a</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_asyncx"><span class="tp">asyncx</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Resolve a promise to <code class="koka">value</code>. Raises an exception if the promise was already resolved.
</p></div></div><div class="decl" id="try_await"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#try_await">try<span class="dash">-</span>await</a></span>( <span class="tp tpp">p</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_ndet"><span class="tp">ndet</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Returns immediately if the promise was already resolved and otherwise return <code class="koka"><a class="pp" href="std_core.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code>.
</p></div></div></div></div>
<div class="decl" id="type_space_promise_state"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_promise_state"><span class="tp">promise<span class="dash">-</span>state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a></span></span><span class="tp">&lt;<span class="tp tv">a</span>&gt;</span></div></div>
<div class="decl" id="type_space_scope"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a></span></span><span class="tp"></span></div><div class="nested"><div class="decl" id="cancel"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#cancel">cancel</a></span>( <span class="tp tpp">scope</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div></div></div></div>
<div class="decl" id="type_space_timeout_id"><div class="header code"><span class="def"><span class="kw">type</span>&nbsp;<span class="tp"><a class="pp" href="std_async-source.html#type_space_timeout_id"><span class="tp">timeout<span class="dash">-</span>id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a></span></span><span class="tp"></span></div><div class="doc koka comment">

<p class="p noindent">   abstract wid for timeout handlers.
</p></div></div>
<div class="decl" id="async_handle"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#async_handle">async<span class="dash">-</span>handle</a></span>( <span class="tp tpp">action</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   The outer <code class="koka"><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></code> effect handler. This is automatically applied by the compiler
   around the <code class="koka">main</code> function if it has an <code class="koka"><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></code> effect.
</p></div></div>
<div class="decl" id="async_iox"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#async_iox">async<span class="dash">-</span>iox</a></span>( <span class="tp tpp">action</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io_noexn"><span class="tp">io<span class="dash">-</span>noexn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io<span class="dash">-</span>noexn: <span class="tp">E</span></span></a> <span class="tp tv">a</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <span class="tp tv">a</span></div></div>
<div class="decl" id="await_exn"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await_exn">await<span class="dash">-</span>exn</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Primitive: Execute <code class="koka">setup</code> to set up an asynchronous callback with the host platform. Invoke <code class="koka">cb</code> as the callback:
   it takes either an exception or a result <code class="koka">a</code>. Usually <code class="koka">setup</code> returns <code class="koka"><a class="pp" href="std_core.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> but you can return a <code class="koka"><a class="pp" href="std_core.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a>(cleanup)</code>
   value where the <code class="koka">cleanup</code> functions is invoked on cancellation to dispose of any resources (see the implementation of <code class="koka">wait</code>).
   The callback should be invoked exactly once &#8211; when that happens <code class="koka"><a class="pp" href="#await_exn">await<span class="dash">-</span>exn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> is resumed with the result.
</p></div></div>
<div class="decl" id="await_exn0"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await_exn0">await<span class="dash">-</span>exn0</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Convenience function for awaiting a NodeJS style callback where the first argument is a possible exception.
</p></div></div>
<div class="decl" id="await_exn1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await_exn1">await<span class="dash">-</span>exn1</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Convenience function for awaiting a NodeJS style callback where the first argument is a possible exception
   and the second argument the possible result value.
</p></div></div>
<div class="decl" id="await_1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await_1">await</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Execute <code class="koka">setup</code> to set up an asynchronous callback with the host platform. Invoke <code class="koka">cb</code> as the callback:
   it takes either an exception or a result <code class="koka">a</code>. Usually <code class="koka">setup</code> returns <code class="koka"><a class="pp" href="std_core.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a></code> but you can return a <code class="koka"><a class="pp" href="std_core.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">maybe</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span></span></a>(cleanup)</code>
   value where the <code class="koka">cleanup</code> functions is invoked on cancellation to dispose of any resources (see the implementation of <code class="koka">wait</code>).
   The callback should be invoked exactly once &#8211; when that happens <code class="koka">await</code> is resumed with the result using <code class="koka"><a class="pp" href="std_core.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">&#62;</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a></code>
   either raise an exception or return the plain result.
</p></div></div>
<div class="decl" id="await0"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await0">await0</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Convenience function for awaiting a zero argument callback.
</p></div></div>
<div class="decl" id="await1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#await1">await1</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Convenience function for awaiting a single argument callback.
</p></div></div>
<div class="decl" id="cancel_1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#cancel_1">cancel</a></span>()<span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   The <code class="koka">cancel</code> operations cancels any outstanding asynchronous operation under the innermost
   <code class="koka"><a class="pp" href="#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&#60;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&#62;</span> <span class="tp tv">a</span></span></a></code> handler by returning the <code class="koka"><span class="co">Cancel</span></code> exception. The <code class="koka">cancel</code> operation itself returns normally
   without raising a <code class="koka"><span class="co">Cancel</span></code> exception.
</p></div></div>
<div class="decl" id="cancelable"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#cancelable">cancelable</a></span>( <span class="tp tpp">action</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></div><div class="doc koka comment">

<p class="p noindent">   Execute <code class="koka">action</code> in a cancelable scope. If <code class="koka">cancel</code> is called within <code class="koka">action</code>,
   any outstanding asynchronous operations started in the cancelable scope are canceled.
   (Outstanding operations outside the cancelable scope are not canceled).
</p></div></div>
<div class="decl" id="do_await"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#do_await">do<span class="dash">-</span>await</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_await_setup"><span class="tp">await<span class="dash">-</span>setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span>, <span class="tp tpp">scope</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <span class="tp tpp">cancelable?</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div></div>
<div class="decl" id="interleaved"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#interleaved">interleaved</a></span>( <span class="tp tpp">action1</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span>, <span class="tp tpp">action2</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></div><div class="doc koka comment">

<p class="p noindent">   Interleave two actions around their asynchronous operations.
</p></div></div>
<div class="decl" id="interleaved_1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#interleaved_1">interleaved</a></span>( <span class="tp tpp">xs</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Interleave a list of actions around their asynchronous operations.
</p></div></div>
<div class="decl" id="interleavedx"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#interleavedx">interleavedx</a></span>( <span class="tp tpp">action1</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span>, <span class="tp tpp">action2</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></div><div class="doc koka comment">

<p class="p noindent">   Interleave two actions around their asynchronous operations and explicitly returning either
   their result or their exception.
</p></div></div>
<div class="decl" id="interleavedx_1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#interleavedx_1">interleavedx</a></span>( <span class="tp tpp">xs</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></div><div class="doc koka comment">

<p class="p noindent">   Interleave a list actions around their asynchronous operations and explicitly returning either
   either their result or their exception.
</p></div></div>
<div class="decl" id="no_await"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#no_await">no<span class="dash">-</span>await</a></span>( <span class="tp tpp">setup</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_await_setup"><span class="tp">await<span class="dash">-</span>setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span>, <span class="tp tpp">scope</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <span class="tp tpp">cancelable?</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a>, <span class="tp tpp">f</span> <span class="tp sp">:</span>&nbsp;<span class="tp sp">(</span><a class="pp" href="std_core.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core.html#type_space_io"><span class="tp">io</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div></div>
<div class="decl" id="wait"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#wait">wait</a></span>( <span class="tp tpp">secs</span> <span class="tp sp">:</span>&nbsp;<a class="pp" href="std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Wait (asynchronously) for <code class="koka">secs</code> seconds as a <code class="koka"><a class="pp" href="std_core.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a></code>.
   Use <code class="koka"><a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()</code> to yield to other asynchronous operations.
</p></div></div>
<div class="decl" id="wait_1"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#wait_1">wait</a></span>( <span class="tp tpp">secs</span> <span class="tp sp">:</span>&nbsp;<span class="tp op">?</span><a class="pp" href="std_time_duration.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a> ) <span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Wait (asynchronously) for optional <code class="koka">secs</code> seconds <code class="koka"><a class="pp" href="std_time_duration.html#type_space_duration"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration: <span class="tp">V</span></span></a></code> (<code class="koka"><span class="kw">=</span> <span class="number">0</span><span class="kw op">.</span>seconds</code>).
   Use <code class="koka"><a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-&gt;</span> <span class="tp sp">&#60;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&#62;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()</code> to yield generally to other asynchronous operations.
</p></div></div>
<div class="decl" id="yield"><div class="header code"><span class="def"><span class="kw">fun</span>&nbsp;<a class="link" href="std_async-source.html#yield">yield</a></span>()<span class="tp sp">:</span>&nbsp;<span class="tp sp">&lt;</span><a class="pp" href="std_core.html#type_space_exn"><span class="tp">exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core.html#type_space__lp__rp_"><span class="tp">()</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></div><div class="doc koka comment">

<p class="p noindent">   Yield to other asynchronous operations. Same as <code class="koka">wait(<span class="number">0</span>)</code>.
</p></div></div>
<div class="decl" id="-private-imports"><div class="header code"><span class="def"><span class="kw">private import</span>&nbsp;<span class="code"><a class="pp" href="std_core.html"><span class="mo">std<span class="fslash">/</span>core</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core</span></span></a></span>, <span class="code"><a class="pp" href="std_data_dict.html"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict</span><span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict</span></span></a></span>, <span class="code"><a class="pp" href="std_data_array.html"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>array</span><span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>array</span></span></a></span>, <span class="code"><a class="pp" href="std_num_int32.html"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32</span></span></a></span>, <span class="code"><a class="pp" href="std_num_ddouble.html"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>ddouble</span></span></a></span>, <span class="code"><a class="pp" href="std_time_duration.html"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration</span></span></a></span>, <span class="code"><a class="pp" href="std_debug.html"><span class="mo">std<span class="fslash">/</span>debug</span><span class="pc"><span class="mo">std<span class="fslash">/</span>debug</span></span></a></span></span></div></div>
</div></body>
</html>

<span data-line=""></span>