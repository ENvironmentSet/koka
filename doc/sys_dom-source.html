<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>dom.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;----------------------------------------------------------------------------
   Copyright (C) Microsoft Corporation
  
   Licensed under the Apache License, Version 2.0 ("The Licence"). You may not
   use this file except in compliance with the License. A copy of the License
   can be found in the file "license.txt" at the root of this distribution.
----------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Utility function to access the DOM inside a browser.
</span><span class="kw">module</span> dom

<span class="kw">import</span> types

<span class="comment">// Execute an action that gains access to the global ":window" object. 
</span><span class="decl-fun" id="withWindow"><span class="kw">public</span> <span class="kw">function</span> <a class="pp" href="sys_dom.html#withWindow">withWindow<span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash last">/</span></span>withWindow: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">window</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp">window</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">&#95;77</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="sys_dom_types-source.html#type_space_window"><span class="tp">window</span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>window: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
{
  <span class="kw">val</span> <a class="pp">success<span class="pc">success: <span class="tp">bool</span></span></a> <span class="kw">=</span> <a class="pp" href="#applyWindow">applyWindow<span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash last">/</span></span>applyWindow: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">window</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp">window</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">&#95;77</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>);
  <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">!</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">success<span class="pc">success: <span class="tp">bool</span></span></a>) <a class="pp" href="std_core-source.html#error">error<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>error: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<span class="st">"this application can only run inside a browser"</span><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
</span>}

<span class="decl-fun" id="applyWindow"><span class="kw">external</span> <a class="pp" href="sys_dom.html#applyWindow">applyWindow<span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash last">/</span></span>applyWindow: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">window</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <span class="tp sp">(</span> <span class="tp tpp">action</span><span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="sys_dom_types-source.html#type_space_window"><span class="tp">window</span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>window: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> { 
  js inline <span class="st">"(typeof window !== 'undefined' ? (function(){ (#1)(window); return true; })() : false)"</span> 
</span>}


<span class="comment">// Execute an action after a specified time out.
</span><span class="decl-fun" id="timeout"><span class="kw">public</span> <span class="kw">external</span> <a class="pp" href="sys_dom.html#timeout">timeout<span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash last">/</span></span>timeout: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">msecs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">(</span> <span class="tp tpp">msecs</span><span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span> <span class="tp tpp">action</span><span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
{ 
  js inline <span class="st">"window.setTimeout(#2,#1)"</span> 
</span>}

<span class="comment">// Execute an action on a specified interval.
</span><span class="decl-fun" id="interval"><span class="kw">public</span> <span class="kw">external</span> <a class="pp" href="sys_dom.html#interval">interval<span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash last">/</span></span>interval: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">msecs</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">dom</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">(</span> <span class="tp tpp">msecs</span><span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span> <span class="tp tpp">action</span><span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="sys_dom_types-source.html#type_space_dom"><span class="tp"><span class="effect">dom</span></span><span class="pc"><span class="mo">sys<span class="fslash">/</span>dom<span class="fslash">/</span>types<span class="fslash last">/</span></span>dom: <span class="tp">E</span></span></a><span class="tp sp">|</span><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
{ 
  js inline <span class="st">"window.setInterval(#2,#1)"</span> 
</span>}
</pre>

</div></body>
</html>
