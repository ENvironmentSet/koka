<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>async.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;---------------------------------------------------------------------------
	Copyright 2012-2016 Microsoft Corporation.

	This is free software; you can redistribute it and/or modify it under the
	terms of the Apache License, Version 2.0. A copy of the License can be
	found in the file "license.txt" at the root of this distribution.
---------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42; Asynchronous primitives

This module is based closely on [@Leijen:async] and aims to have robust and composable asynchronous
primitives. In particular, any outstanding asynchronous operation can be canceled (through &#96;cancel&#96;)
within a certain scope which allows for composable primitives like &#96;timeout&#96; and &#96;firstof&#96;.


## References {-}

~ Bibliography { caption:"0" }
~~ BibItem { #Leijen:async; bibitem-label:"[1]"; searchterm:"Leijen+Daan+Structured+Asynchrony+with+Algebraic+Effects" }
Daan Leijen.
&#95;Structured Asynchrony with Algebraic Effects&#95;.
Microsoft Research technical report MSR-TR-2017-21, May 2017.
[pdf](https://www.microsoft.com/en-us/research/wp-content/uploads/2017/05/asynceffects-msr-tr-2017-21.pdf)
~~
~
\/
&#42;/</span>
<span class="kw">module</span> async

<span class="kw">import</span> dict
<span class="kw">import</span> array
<span class="kw">import</span> int32
<span class="kw">import</span> ddouble    <span class="comment">// for C# backend
</span><span class="kw">import</span> duration
<span class="kw">import</span> debug

<span class="kw">extern</span> include {
	cs file <span class="st">"async-inline.cs"</span>
}

<span class="comment">// A type alias for asynchronous operations that can raise exceptions non-deterministically.
// This is common for almost all &#96;:async&#96; operations since &#96;cancel&#96; and &#96;timeout&#96; can
// cancel operations non-deterministically which raises the &#96;Cancel&#96; exception and cancels
// outstanding asynchronous requests.
</span><span class="decl-alias" id="type_space_asyncx"><span class="kw">public</span> <span class="tp kw">alias</span> <a class="pp" href="std_async.html#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <span class="tp kw">=</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a></span><span class="tp sp">&gt;</span>


<span class="comment">// ----------------------------------------------------------------------------
// Promises
// ----------------------------------------------------------------------------
</span>
<span class="comment">// A &#95;promise&#95; that carries a value of type &#96;:a&#96;. A promise is initially empty
// but can be &#96;await&#96;ed  asynchronously until it gets &#96;resolve&#96;d unblocking any
// &#96;await&#96; operations. After that a promise stays resolved and any &#96;await&#96; will
// return immediately. It is an error to try to resolve a promise more than once.
</span><span class="decl-type" id="type_space_promise"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Promise"><a class="pp" href="std_async.html#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>(
	<span class="decl-fun" id="state_1"><a class="pp">state<span class="pc">state: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="number">106</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_promise_state"><span class="tp">promise-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span>
</span></span>)

<span class="decl-type" id="type_space_promise_state"><span class="kw">abstract</span> <span class="tp kw">type</span> <a class="pp" href="std_async.html#type_space_promise_state"><span class="tp">promise-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="decl-con" id="con_space_Resolved"><a class="pp">Resolved<span class="pc">promise<span class="dash">-</span>state: <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;766</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">value<span class="pc">value: <span class="number">99</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> </span>)
	<span class="decl-con" id="con_space_Awaiting"><a class="pp">Awaiting<span class="pc">promise<span class="dash">-</span>state: <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;778</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="number">99</span>) <span class="kw op">-></span> io ()<span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> </span>)
</span>}

<span class="comment">// Create a new promise.
</span><span class="decl-fun" id="promise"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#promise">promise<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a> { <a class="pp" href="#con_space_Promise"><span class="co">Promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">state</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#con_space_Awaiting"><span class="co">Awaiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Awaiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>))) }
</span>}

<span class="comment">// Await a promise; returns immediately if the promise was already resolved and otherwise
// waits asynchronously.
</span><span class="decl-fun" id="await"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<span class="decl-fun" id="setup"><span class="kw">fun</span> <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state_1">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
		<span class="kw">match</span> (<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="#con_space_Awaiting"><span class="co">Awaiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Awaiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Awaiting"><span class="co">Awaiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Awaiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>))
			<a class="pp" href="#con_space_Resolved"><span class="co">Resolved</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Resolved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;3789</span></span></a>) <span class="kw op">-></span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;3789</span></span></a>) <span class="comment">// resume right away; should not happen due to try-await
</span>		}
	</span>}
	<span class="kw">match</span>(<a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3789</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#try_await">try-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>try<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;3789</span></span></a>) <span class="kw op">-></span> <a class="pp">v<span class="pc">v: <span class="tp tv">&#95;3789</span></span></a>
		<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#await1">await1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;3789</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)
	}
</span>}

<span class="comment">// Returns immediately if the promise was already resolved and otherwise return &#96;Nothing&#96;.
</span><span class="decl-fun" id="try_await"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#try_await">try-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>try<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3691</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#async_io_noexn">async-io-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
		<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3691</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3691</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state_1">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
		<span class="kw">match</span>(<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3691</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="#con_space_Resolved"><span class="co">Resolved</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Resolved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;3691</span></span></a>) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;3691</span></span></a>)
			&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
		}
	}
</span>}

<span class="comment">// Resolve a promise to &#96;value&#96;. Raises an exception if the promise was already resolved.
</span><span class="decl-fun" id="resolve"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#resolve">resolve<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>resolve: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9623</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>promise: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;9623</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#async_io">async-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a> {
		<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9623</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9623</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state_1">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
		<span class="kw">match</span>(<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9623</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="#con_space_Awaiting"><span class="co">Awaiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Awaiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;9623</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
				<a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9623</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Resolved"><span class="co">Resolved</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Resolved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;9623</span></span></a>)
				<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;9623</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">cbx<span class="pc">cbx: <span class="tp sp">(</span><span class="tp tv">&#95;9623</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {  <span class="comment">// todo: through set-immediate?
</span>					<a class="pp">cbx<span class="pc">cbx: <span class="tp sp">(</span><span class="tp tv">&#95;9623</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;9623</span></span></a>) <span class="comment">// set-immediate1( cbx, value )
</span>				}
			}
			&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#error">error<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>error: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<span class="st">"Promise was already resolved"</span>)
		}
	}
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Channels
// ----------------------------------------------------------------------------
</span>
<span class="comment">// A &#95;channel&#95; of values of type &#96;:a&#96;. Values can be asynchronously &#96;emit&#96;ed into
// a channel, and asynchronously &#96;receive&#96;d.
</span><span class="decl-type" id="type_space_channel"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Channel"><a class="pp" href="std_async.html#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>(
	<span class="decl-fun" id="chid"><a class="pp">chid<span class="pc">chid: <span class="tp">int</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>,
	<span class="decl-fun" id="state"><a class="pp">state<span class="pc">state: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="number">93</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_channel_state"><span class="tp">channel-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span>
</span></span>)

<span class="comment">// todo: use queue data type for the values and listeners for better complexity
</span><span class="decl-type" id="type_space_channel_state"><span class="kw">abstract</span> <span class="tp kw">type</span> <a class="pp" href="std_async.html#type_space_channel_state"><span class="tp">channel-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="decl-con" id="con_space_Empty"><a class="pp">Empty<span class="pc">channel<span class="dash">-</span>state: <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;667</span><span class="tp sp">&gt;</span></span></a></span>
	<span class="decl-con" id="con_space_Values"><a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">Values</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a>( <a class="pp">value<span class="pc">value: <span class="number">86</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">values<span class="pc">values: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="number">86</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> </span>)
	<span class="decl-con" id="con_space_Waiting"><a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">Waiting</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a>( <a class="pp">listener<span class="pc">listener: <span class="tp sp">(</span><span class="number">86</span>) <span class="kw op">-></span> io ()</span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="number">86</span>) <span class="kw op">-></span> io ()<span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> </span>)
</span>}

<span class="decl-fun" id="from_values"><span class="kw">fun</span> <a class="pp" href="std_async.html#from_values">from-values<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>from<span class="dash">-</span>values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">values<span class="pc">values: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5299</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel_state"><span class="tp">channel-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">values<span class="pc">values: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5299</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5299</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5299</span><span class="tp sp">&gt;</span></span></a>)  <span class="kw op">-></span> <a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5299</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5299</span><span class="tp sp">&gt;</span></span></a>)
	}
</span>}

<span class="decl-fun" id="from_waiting"><span class="kw">fun</span> <a class="pp" href="std_async.html#from_waiting">from-waiting<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>from<span class="dash">-</span>waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>) <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel_state"><span class="tp">channel-state</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel<span class="dash">-</span>state: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">listeners<span class="pc">listeners: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>)  <span class="kw op">-></span> <a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4175</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>)
	}
</span>}

<span class="comment">// Create a new asynchronous channel.
</span><span class="decl-fun" id="channel"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#channel">channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a> {
		<a class="pp" href="#con_space_Channel"><span class="co">Channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Channel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">chid</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">state</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#unique">unique<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unique: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>(), <a class="pp" href="std_core-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>))
	}
</span>}

<span class="comment">// Receive (and remove) a value from the channel: returns immediately if a value is available and otherwise
// waits asynchronously until a value becomes available.
</span><span class="decl-fun" id="receive"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#receive">receive<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>receive: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a>( <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9599</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9599</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#receivex">receivex<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>receivex: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}

<span class="decl-fun" id="receivex"><span class="kw">fun</span> <a class="pp" href="std_async.html#receivex">receivex<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>receivex: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp op">?</span><span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="decl-fun" id="setup"><span class="kw">fun</span> <a class="pp">setup<span class="pc">setup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">&#95;</span><span class="pc">&#95;(159,26): <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">&#95;</span><span class="pc">&#95;(159,28): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> )  {
		<span class="decl-fun" id="cbr"><span class="kw">fun</span> <a class="pp">cbr<span class="pc">cbr: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;5945</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;5945</span></span></a>),<a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>) </span>}
		<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">channel</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
		<span class="kw">match</span> (<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cbr<span class="pc">cbr: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
			<a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">cbr<span class="pc">cbr: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
			<a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5945</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">-></span> {  <span class="comment">// this case should not happen due to &#96;try-receive?&#96;
</span>				<a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#from_values">from-values<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>from<span class="dash">-</span>values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span></span></a>)
				<a class="pp">cbr<span class="pc">cbr: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;5945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5945</span></span></a>)
			}
		}
		<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
	</span>}
	<span class="kw">match</span>(<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#try_receive_ques_">try-receive?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>try<span class="dash">-</span>receive?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5945</span></span></a>) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5945</span></span></a>)
		<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="#do_await">do-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>do<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5945</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>,<a class="pp" href="#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a>,<a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp">bool</span></span></a>)
	}
</span>}

<span class="comment">// Return immediately if a value is available on the channel and otherwise returns &#96;Nothing&#96;.
</span><span class="decl-fun" id="try_receive_ques_"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#try_receive_ques_">try-receive?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>try<span class="dash">-</span>receive?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#async_io_noexn">async-io-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
		<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">channel</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
		<span class="kw">match</span> (<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5835</span></span></a>, <a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
				<a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#from_values">from-values<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>from<span class="dash">-</span>values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5835</span><span class="tp sp">&gt;</span></span></a>)
				<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;5835</span></span></a>)
			}
			&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
		}
	}
</span>}

<span class="decl-fun" id="emit_io"><span class="kw">fun</span> <a class="pp" href="std_async.html#emit_io">emit-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;4201</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">channel</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
	<span class="kw">match</span>(<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;4201</span></span></a>, <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
		<a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;4201</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span></span></a>)  <span class="kw op">-></span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;4201</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">value<span class="pc">value: <span class="tp tv">&#95;4201</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
		<a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;4201</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4201</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> {
			<a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4201</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#from_waiting">from-waiting<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>from<span class="dash">-</span>waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;4201</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>)
			<a class="pp">l<span class="pc">l: <span class="tp sp">(</span><span class="tp tv">&#95;4201</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;4201</span></span></a>)
		}
	}
</span>}

<span class="comment">// Emit a value asynchronously into a channel.
</span><span class="decl-fun" id="emit"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#emit">emit<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5236</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5236</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#async_io">async-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a> {
		<a class="pp" href="#emit_io">emit-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5236</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5236</span></span></a>)
	}
</span>}

<span class="decl-fun" id="trace_channel"><span class="kw">fun</span> <a class="pp" href="std_async.html#trace_channel">trace-channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>trace<span class="dash">-</span>channel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">msg</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">msg<span class="pc">msg: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;11490</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#async_io_noexn">async-io-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> {
		<a class="pp" href="#trace_channel_io">trace-channel-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>trace<span class="dash">-</span>channel<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">msg</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">msg<span class="pc">msg: <span class="tp">string</span></span></a>, <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;11490</span><span class="tp sp">&gt;</span></span></a> )
	}
</span>}

<span class="decl-fun" id="trace_channel_io"><span class="kw">fun</span> <a class="pp" href="std_async.html#trace_channel_io">trace-channel-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>trace<span class="dash">-</span>channel<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">msg</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">msg<span class="pc">msg: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io_noexn"><span class="tp"><span class="effect">io-noexn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io<span class="dash">-</span>noexn: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<span class="kw">val</span> <a class="pp">msgx<span class="pc">msgx: <span class="tp">string</span></span></a> <span class="kw">=</span> <a class="pp">msg<span class="pc">msg: <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">": id="</span> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#chid">chid<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>chid: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">channel</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>
	<span class="kw">val</span> <a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#state">state<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>state: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">channel</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
	<span class="kw">match</span>(<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">r<span class="pc">r: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="#con_space_Empty"><span class="co">Empty</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Empty: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#trace">trace<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trace: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">msgx<span class="pc">msgx: <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">", empty"</span>)
		<a class="pp" href="#con_space_Values"><span class="co">Values</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Values: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">values</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">v<span class="pc">v: <span class="tp tv">&#95;10231</span></span></a>,<a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#trace_any">trace-any<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trace<span class="dash">-</span>any: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">msgx<span class="pc">msgx: <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">", full: "</span> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> (<span class="number">1</span> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">vs<span class="pc">vs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;10231</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#length_1">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>length<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">": "</span>, <a class="pp">v<span class="pc">v: <span class="tp tv">&#95;10231</span></span></a> )
		<a class="pp" href="#con_space_Waiting"><span class="co">Waiting</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Waiting: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">listener</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">listeners</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">channel<span class="dash">-</span>state</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(&#95;,<a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;10231</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#trace">trace<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trace: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">msgx<span class="pc">msgx: <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">", listeners: "</span> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> (<span class="number">1</span> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <a class="pp">ls<span class="pc">ls: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">&#95;10231</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#length_1">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>length<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>)
	}
</span>}

<span class="decl-fun" id="trace_anyx"><span class="kw">fun</span> <a class="pp" href="std_async.html#trace_anyx">trace-anyx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>trace<span class="dash">-</span>anyx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;1177</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="std_core-source.html#trace_any">trace-any<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>trace<span class="dash">-</span>any: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">s<span class="pc">s: <span class="tp">string</span></span></a>,<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;1177</span></span></a>)
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Asynchronous timeout and waiting
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Execute &#96;action&#96; but if it is not finished within &#96;secs&#96; seconds duration
// &#96;cancel&#96; it (and return &#96;Nothing&#96;). Due to the generality of &#96;cancel&#96;, this &#96;timeout&#96;
// abstraction can reliably time out over any composition of asynchronous operations
// and is therefore quite expressive.
</span><span class="comment">/&#42;
public fun timeout( secs : duration, action : () -&gt; &lt;asyncx|e&gt; a ) : &lt;asyncx|e&gt; maybe&lt;a&gt; {
	firstof	{ wait(secs); Nothing }
		{ Just(action()) }
}

// Execute &#96;a&#96; and &#96;b&#96; interleaved. As soon as one of them finishes,
// &#96;cancel&#96; the other one and return the result of the first.
public fun firstof( a : () -&gt; &lt;asyncx|e&gt; a, b : () -&gt; &lt;asyncx|e&gt; a  ) : &lt;asyncx|e&gt; a  {
	cancelable {
		val (ra,rb) = interleavedx	{ val x = a(); cancel(); x }
			{ val x = b(); cancel(); x }
		match(ra) {
			Exn(exn) | exn.cancel? -&gt; rb.untry
			&#95;  -&gt; ra.untry
		}
	}
}
&#42;/</span>
<span class="comment">// Wait (asynchronously) for &#96;secs&#96; seconds as a &#96;:double&#96;.
// Use &#96;yield()&#96; to yield to other asynchronous operations.
</span><span class="decl-fun" id="wait"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#wait">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_double"><span class="tp">double</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>double: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">secs<span class="pc">secs: <span class="tp">double</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#duration_2">duration<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>duration<span class="postfix">.2</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp">double</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">duration</span></span></a>)
</span>}

<span class="comment">// Wait (asynchronously) for optional &#96;secs&#96; seconds &#96;:duration&#96; (&#96;= 0.seconds&#96;).
// Use &#96;yield()&#96; to yield generally to other asynchronous operations.
</span><span class="decl-fun" id="wait_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#wait_1">wait<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>wait<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">secs</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">secs<span class="pc">secs: <span class="tp op">?</span><span class="tp">duration</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">duration</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw">=</span> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">secs</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#_lt__eq_">&lt;=<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>(&lt;=): <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_time_duration-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>zero: <span class="tp">duration</span></span></a>) <span class="kw">then</span> <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
	<span class="kw">val</span> <a class="pp">msecs<span class="pc">msecs: <span class="tp">int32</span></span></a> <span class="kw">=</span> <a class="pp" href="std_num_int32-source.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>(<a class="pp" href="std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a>,<a class="pp">secs<span class="pc">secs: <span class="tp">duration</span></span></a><span class="kw op">.</span><a class="pp" href="std_time_duration-source.html#milli_seconds">milli-seconds<span class="pc"><span class="mo">std<span class="fslash">/</span>time<span class="fslash">/</span>duration<span class="fslash last">/</span></span>milli<span class="dash">-</span>seconds: <span class="tp sp">(</span><span class="tp tpp">d</span> <span class="tp kw op">:</span> <span class="tp">duration</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#int32">int32<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>)
	<a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<span class="kw">val</span> <a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="kw">=</span> <a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <span class="kw">fun</span>(){ <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) }, <a class="pp">msecs<span class="pc">msecs: <span class="tp">int32</span></span></a> )
		<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( { <a class="pp" href="#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a>) } )
	}
</span>}

<span class="comment">// Yield to other asynchronous operations. Same as &#96;wait(0)&#96;.
</span><span class="decl-fun" id="yield"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#yield">yield<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>yield: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#await0">await0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<a class="pp" href="#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>, <a class="pp" href="std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a> )
		<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
	}
</span>}

<span class="comment">// abstract wid for timeout handlers
</span><span class="decl-type" id="type_space_timeout_id"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Timeout_id"><a class="pp" href="std_async.html#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a>(
	<span class="decl-fun" id="timer"><a class="pp">timer<span class="pc">timer: <span class="tp">any</span></span></a></span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>any: <span class="tp">V</span></span></a>
</span></span>)

<span class="decl-fun" id="set_timeout"><span class="kw">fun</span> <a class="pp" href="std_async.html#set_timeout">set-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> {
	<a class="pp" href="#con_space_Timeout_id"><span class="co">Timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Timeout<span class="dash">-</span>id: <span class="tp sp">(</span><span class="tp tpp">timer</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">timeout<span class="dash">-</span>id</span></span></a>(<a class="pp" href="#set_timeoutx">set-timeoutx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeoutx: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">any</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp" href="std_num_int32-source.html#max">max<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>max: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">,</span> <span class="tp tpp">j</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span></span></a>(<a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a>,<a class="pp" href="std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a>)))
</span>}

<span class="decl-fun" id="set_timeoutx"><span class="kw">extern</span> <a class="pp" href="std_async.html#set_timeoutx">set-timeoutx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>set<span class="dash">-</span>timeoutx: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">ms</span> <span class="tp kw op">:</span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">any</span></span></a>( <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">ms<span class="pc">ms: <span class="tp">int32</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int32: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>any: <span class="tp">V</span></span></a> {
	cs <span class="st">"&#95;Async.SetTimeout"</span>
	js <span class="st">"setTimeout"</span>
</span>}

<span class="decl-fun" id="clear_timeout"><span class="kw">fun</span> <a class="pp" href="std_async.html#clear_timeout">clear-timeout<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeout: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_timeout_id"><span class="tp">timeout-id</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timeout<span class="dash">-</span>id: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#clear_timeoutx">clear-timeoutx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeoutx: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">tid<span class="pc">tid: <span class="tp">timeout<span class="dash">-</span>id</span></span></a><span class="kw op">.</span><a class="pp" href="#timer">timer<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>timer: <span class="tp sp">(</span><span class="tp">timeout<span class="dash">-</span>id</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">any</span></span></a>)
</span>}

<span class="decl-fun" id="clear_timeoutx"><span class="kw">extern</span> <a class="pp" href="std_async.html#clear_timeoutx">clear-timeoutx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>clear<span class="dash">-</span>timeoutx: <span class="tp sp">(</span><span class="tp tpp">tid</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">tid<span class="pc">tid: <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>any: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	cs <span class="st">"&#95;Async.ClearTimeout"</span>
	js <span class="st">"clearTimeout"</span>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Interleaved strands of execution
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Interleave two actions around their asynchronous operations.
</span><span class="decl-fun" id="interleaved"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#interleaved">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action1</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action2</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>( <a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9013</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9011</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9013</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9012</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
	<span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9011</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9012</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="#interleavedx">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action1</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action2</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( {<span class="kw">inject</span> behind<span class="op">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="op">&gt;</span>(<a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9013</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9011</span></span></a>)}, {<span class="kw">inject</span> behind<span class="op">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="op">&gt;</span>(<a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9013</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9012</span></span></a>)} )
	<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9011</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9012</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#ordered__throw">ordered&#95;throw<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>ordered&#95;throw: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
	<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">ra<span class="pc">ra: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9011</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>,<a class="pp">rb<span class="pc">rb: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9012</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
</span>}

<span class="comment">// Interleave a list of actions around their asynchronous operations.
</span><span class="decl-fun" id="interleaved_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#interleaved_1">interleaved<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9238</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9237</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">val</span> <a class="pp">ress<span class="pc">ress: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9237</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9238</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9237</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9238</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9237</span></span></a>) { <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;9238</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9237</span></span></a> { <span class="kw">inject</span> behind<span class="op">&lt;</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="op">&gt;</span>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;9238</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;9237</span></span></a>) } } )<span class="kw op">.</span><a class="pp" href="#interleavedx_1">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>
	<span class="comment">//ress.map(maybe).ordered&#95;throw
</span>	<a class="pp">ress<span class="pc">ress: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;9237</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>)
</span>}

<span class="decl-fun" id="ordered__throw"><span class="kw">fun</span> <a class="pp" href="std_async.html#ordered__throw">ordered&#95;throw<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>ordered&#95;throw: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="std_core-source.html#local_var"><span class="kw">var</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>var: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span></span></a> <a class="pp">mexn<span class="pc">mexn: <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8625</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">:=</span> <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
	<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>) {
		<span class="kw">match</span>(<a class="pp">x<span class="pc">x: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
			<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp" href="std_core-source.html#local_get">mexn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a>) {
				<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">mexn<span class="pc">mexn: <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8625</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#local_set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>
				<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exnx<span class="pc">exnx: <span class="tp">exception</span></span></a>) <span class="kw op">-></span>
					<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#finalize_ques__1">finalize?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>finalize?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">exnx<span class="pc">exnx: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#finalize_ques__1">finalize?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>finalize?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <a class="pp" href="std_core-source.html#_bar__bar_">||<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(||): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> (<a class="pp">exnx<span class="pc">exnx: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#cancel_ques__1">cancel?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>cancel?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#cancel_ques__1">cancel?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>cancel?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>))
						<span class="kw">then</span> <a class="pp">mexn<span class="pc">mexn: <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8625</span><span class="tp sp">,</span><span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#local_set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>
			}
		}
	}
	<span class="kw">match</span>(<a class="pp" href="std_core-source.html#local_get">mexn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)	<span class="kw op">-></span> <a class="pp" href="std_core-source.html#throw">throw<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>throw: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
		<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>	<span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
	}
</span>}

<span class="comment">// Interleave two actions around their asynchronous operations and explicitly returning either
// their result or their exception.
</span><span class="decl-fun" id="interleavedx"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#interleavedx">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action1</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action2</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">)</span></span></a>( <a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8205</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8206</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
	<span class="decl-fun" id="act1"><span class="kw">fun</span> <a class="pp">act1<span class="pc">act1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() { <a class="pp" href="std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action1<span class="pc">action1: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8205</span></span></a>()) </span>}
	<span class="decl-fun" id="act2"><span class="kw">fun</span> <a class="pp">act2<span class="pc">act2: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span></span></a>() { <a class="pp" href="std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action2<span class="pc">action2: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8206</span></span></a>()) </span>}
	<span class="kw">match</span>( <a class="pp" href="#interleavedx_1">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">act1<span class="pc">act1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">act2<span class="pc">act2: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;8207</span><span class="tp sp">&gt;</span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)) {
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">y<span class="pc">y: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unleft">unleft<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unleft: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">y<span class="pc">y: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;8205</span><span class="tp sp">,</span><span class="tp tv">&#95;8206</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unright">unright<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unright: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
		&#95; <span class="kw op">-></span> {
			<span class="comment">// this will never happen..
</span>			<span class="kw">val</span> <a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"invalid interleaved result"</span>,<a class="pp" href="std_core-source.html#con_space_Internal"><span class="co">Internal</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Internal: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>(<span class="st">"std/async/interleavedx(action1,action2)"</span>))
			<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>),<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
		}
	}
</span>}

<span class="decl-fun" id="unleft"><span class="kw">fun</span> <a class="pp" href="std_async.html#unleft">unleft<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unleft: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1085</span><span class="tp sp">,</span><span class="tp tv">&#95;1086</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1085</span><span class="tp sp">,</span><span class="tp tv">&#95;1086</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Left"><span class="co">Left</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Left: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">left</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp tv">&#95;1085</span></span></a>)) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">l<span class="pc">l: <span class="tp tv">&#95;1085</span></span></a>)
		<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)  <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
		&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"invalid left interleaved result"</span>,<a class="pp" href="std_core-source.html#con_space_Internal"><span class="co">Internal</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Internal: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>(<span class="st">"std/async/interleavedx(action1,action2)"</span>)))
	}
</span>}
<span class="decl-fun" id="unright"><span class="kw">fun</span> <a class="pp" href="std_async.html#unright">unright<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unright: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1126</span><span class="tp sp">,</span><span class="tp tv">&#95;1127</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_either"><span class="tp">either</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>either: <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;1126</span><span class="tp sp">,</span><span class="tp tv">&#95;1127</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Right"><span class="co">Right</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Right: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">right</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">either</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">r<span class="pc">r: <span class="tp tv">&#95;1127</span></span></a>)) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">r<span class="pc">r: <span class="tp tv">&#95;1127</span></span></a>)
		<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)     <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
		&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#exception">exception<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">info</span> <span class="tp kw op">:</span> <span class="tp">exception<span class="dash">-</span>info</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>(<span class="st">"invalid right interleaved result"</span>,<a class="pp" href="std_core-source.html#con_space_Internal"><span class="co">Internal</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Internal: <span class="tp sp">(</span><span class="tp tpp">name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception<span class="dash">-</span>info</span></span></a>(<span class="st">"std/async/interleavedx(action1,action2)"</span>)))
	}
</span>}

<span class="comment">// Private effect to keep track of when a strand in an interleaving is done.
// Preferred over using built-in state as this works well if there is an outer handler
// over the state that resumes more than once -- redoing part of the interleaving.
// See &#96;test/algeff/async5.js&#96;
</span><span class="decl-type" id="type_space_strands"><span class="tp kw">effect</span> <a class="pp" href="std_async.html#type_space_strands"><span class="tp">strands</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>strands: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">HX</span></span></a></span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="comment">// Are there still strands that need to be resumed?
</span>	<span class="kw">fun</span> <span class="decl-fun" id="strands_busy_ques_"><a class="pp"><span class="tp tv">strands-busy?</span><span class="pc">a: <span class="tp">V</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a></span>
	<span class="comment">// Call this when a strand is done.
</span>	<span class="kw">fun</span> <span class="decl-fun" id="strand_done"><a class="pp"><span class="tp tv">strand-done</span><span class="pc">a: <span class="tp">V</span></span></a>(<a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">result<span class="pc">result: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="number">35</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
}

<span class="comment">// Insert in order with an accumulating list.
</span><span class="decl-fun" id="insert_acc"><span class="kw">fun</span> <a class="pp" href="std_async.html#insert_acc">insert-acc<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert<span class="dash">-</span>acc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">acc</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5324</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">acc<span class="pc">acc: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span></span></a>,<a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="op">|</span> <a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="std_core-source.html#_lt__1">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a> <span class="kw op">-></span> <a class="pp" href="#insert_acc">insert-acc<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert<span class="dash">-</span>acc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">acc</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5324</span></span></a>, <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span></span></a>,<a class="pp">acc<span class="pc">acc: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>))
		&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#reverse_append">reverse-append<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>reverse<span class="dash">-</span>append: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">tl</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">acc<span class="pc">acc: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>, <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>,<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5324</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>,<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5324</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) )
	}
</span>}

<span class="comment">// Insert in order
</span><span class="decl-fun" id="insert"><span class="kw">fun</span> <a class="pp" href="std_async.html#insert">insert<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5536</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>, <a class="pp">n<span class="pc">n: <span class="tp op">?</span><span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_optional"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>optional: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a>  <span class="kw">=</span> <span class="number">0</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> <a class="pp" href="std_core-source.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">100</span>)
		<span class="kw">then</span> <a class="pp" href="#insert_acc">insert-acc<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert<span class="dash">-</span>acc: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">acc</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5536</span></span></a>, <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> )
		<span class="kw">else</span> <span class="kw">match</span>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span></span></a>,<a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>) <span class="op">|</span> <a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="std_core-source.html#_lt__1">&lt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span></span></a>, <a class="pp" href="#insert">insert<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">xx<span class="pc">xx: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>, <a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5536</span></span></a>, <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_plus_">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>))
			&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>,<a class="pp">value<span class="pc">value: <span class="tp tv">&#95;5536</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>,<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">&#95;5536</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>)
		}
</span>}


<span class="comment">// Interleave a list actions around their asynchronous operations and explicitly returning either
// either their result or their exception.
</span><span class="decl-fun" id="interleavedx_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#interleavedx_1">interleavedx<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedx<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8321</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8320</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> {
	<span class="kw">val</span> <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8321</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8320</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#length_1">length<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>length<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a>
	<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">0</span>) <span class="kw">then</span> <a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>
	<span class="kw">elif</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">n</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><span class="number">1</span>) <span class="kw">then</span> <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8321</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8320</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#unsafe_try_all">unsafe-try-all<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>try<span class="dash">-</span>all: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
	<span class="kw">else</span> <a class="pp" href="#interleavedn">interleavedn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>,<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;8321</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;8320</span><span class="tp sp">&gt;</span></span></a>)
</span>}

<span class="decl-fun" id="interleavedn"><span class="kw">fun</span> <a class="pp" href="std_async.html#interleavedn">interleavedn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleavedn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6980</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> {
	<a class="pp" href="std_core-source.html#local_var"><span class="kw">var</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>var: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">b</span></span></a> <a class="pp">cr<span class="pc">cr: <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6982</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">some</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> <span class="kw op">:=</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">n<span class="pc">n: <span class="tp">int</span></span></a>,<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
	<a class="pp" href="std_core-source.html#null_const"><span class="kw">with</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null<span class="dash">-</span>const: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> {
		<a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6982</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;6980</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)	{ <a class="pp" href="std_core-source.html#local_get">cr<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a> ) }
		<span class="kw">fun</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">strands-busy?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>()	     { <a class="pp" href="std_core-source.html#local_get">cr<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="std_core-source.html#_gt__1">&gt;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&gt;)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <span class="number">0</span> }
		<span class="kw">fun</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">strand-done<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>,<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span></span></a>) { <a class="pp">cr<span class="pc">cr: <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6982</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#local_set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#local_get">cr<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="std_core-source.html#_dash_">-<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(<span class="dash">-</span>): <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int</span></span></a> <span class="number">1</span>, <a class="pp" href="std_core-source.html#local_get">cr<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>local<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">v</span> <span class="tp kw op">:</span> <span class="tp">local<span class="dash">-</span>var</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">local</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#snd">snd<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>snd: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span></span></a><span class="kw op">.</span><a class="pp" href="#insert">insert<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>insert: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">idx<span class="pc">idx: <span class="tp">int</span></span></a>,<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span></span></a>)<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> }
	}
	(<a class="pp" href="#unsafe_no_ndet_div">unsafe-no-ndet-div<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>no<span class="dash">-</span>ndet<span class="dash">-</span>div: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>{ <a class="pp" href="#interleaved_div">interleaved-div<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="dash">-</span>div: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6980</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;543</span><span class="tp sp">&gt;</span></span></a>) })()
</span>}

<span class="decl-external" id="unsafe_no_ndet_div"><span class="kw">extern</span> inline <a class="pp" href="std_async.html#unsafe_no_ndet_div">unsafe-no-ndet-div<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>no<span class="dash">-</span>ndet<span class="dash">-</span>div: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">(</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> { inline <span class="st">"#1"</span> </span>}
<span class="decl-external" id="inject_effects"><span class="kw">extern</span> inline <a class="pp" href="std_async.html#inject_effects">inject-effects<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>inject<span class="dash">-</span>effects: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">forall</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp">h</span><span class="pc">h: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_total"><span class="tp"><span class="effect">total</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_strands"><span class="tp">strands</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>strands: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">HX</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span>   { inline <span class="st">"#1"</span> </span>}

<span class="decl-fun" id="finalize_ques_"><span class="kw">fun</span> <a class="pp" href="std_async.html#finalize_ques_">finalize?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>finalize?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5259</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">t<span class="pc">t: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;5259</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#finalize_ques__1">finalize?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>finalize?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
		&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
	}
</span>}

<span class="decl-fun" id="cancel_ques_"><span class="kw">fun</span> <a class="pp" href="std_async.html#cancel_ques_">cancel?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">t<span class="pc">t: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4499</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">t<span class="pc">t: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4499</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#cancel_ques__1">cancel?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>cancel?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">exn</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
		&#95; <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
	}
</span>}

<span class="decl-fun" id="interleaved_div"><span class="kw">fun</span> <a class="pp" href="std_async.html#interleaved_div">interleaved-div<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interleaved<span class="dash">-</span>div: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_div"><span class="tp"><span class="effect">div</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>div: <span class="tp">X</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_strands"><span class="tp">strands</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>strands: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">HX</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<span class="kw">val</span> <a class="pp">strands<span class="pc">strands: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span>	<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_indexed">map-indexed<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="dash">-</span>indexed: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a> <span class="kw">fun</span>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>,<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6239</span></span></a>) {
			<a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>() {
				<span class="kw">val</span> <a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#unsafe_try_all">unsafe-try-all<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>try<span class="dash">-</span>all: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#inject_effects">inject-effects<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>inject<span class="dash">-</span>effects: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;6239</span></span></a>))
				<a class="pp" href="#strand_done">strand-done<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>strand<span class="dash">-</span>done: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">idx</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">i<span class="pc">i: <span class="tp">int</span></span></a>,<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span></span></a>)
				<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">res</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#finalize_ques_">finalize?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>finalize?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">t</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>  <span class="comment">// cancel others if finalization happens
</span>			}
		}
	<span class="kw">val</span> <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp kw">some</span><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="#channel">channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>()
	<span class="kw">val</span> <a class="pp">handle-strand<span class="pc">handle<span class="dash">-</span>strand: <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#null_return"><span class="kw">handler</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null<span class="dash">-</span>return: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> {
		<span class="kw">control</span> raw <a class="pp">do-await<span class="pc">context: <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>) {
			<a class="pp" href="#no_await">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>no<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>, <a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>) <span class="kw">fun</span>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span></span></a>) {
				<span class="comment">// emit a resumption of this strand into the channel
</span>				<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#emit_io">emit-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="comment">/&#42; no-cps &#42;/</span> { <a class="pp">context<span class="pc">context: <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#resume">resume<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6336</span><span class="tp sp">&gt;</span></span></a>) }  )
			}
			<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>  <span class="comment">// stop the strand at this point
</span>		}

		<span class="comment">// redirect all other operations
</span>		<span class="kw">fun</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6425</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>,<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6425</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)	{ <a class="pp" href="#no_await">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>no<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6425</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>,<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6425</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) }
		<span class="kw">fun</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;6557</span></span></a>)   { <a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;6557</span></span></a>) }
		<span class="kw">fun</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)	 { <a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>) }
	}
	<a class="pp">strands<span class="pc">strands: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">strand<span class="pc">strand: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<a class="pp">handle-strand<span class="pc">handle<span class="dash">-</span>strand: <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>{<span class="kw">inject</span> behind<span class="op">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="op">&gt;</span>(<a class="pp">strand<span class="pc">strand: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)}
	}

	<a class="pp" href="std_core-source.html#while">while<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>while: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">predicate</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> { <a class="pp" href="#strands_busy_ques_">strands-busy?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>strands<span class="dash">-</span>busy?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">bool</span></span></a>() } {  <span class="comment">// while there are resumptions on the strands..
</span>		<span class="comment">// the only way receive can throw is through a cancelation -- but in that case
</span>		<span class="comment">// we should not cancel but instead await all canceled strands; so keep listening on the channel.
</span>		<span class="kw">match</span>(<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#receivex">receivex<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>receivex: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp op">?</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>)) {
			<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(&#95;exn) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="comment">// ignore cancelation on receive
</span>			<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">strand-resume<span class="pc">strand<span class="dash">-</span>resume: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> <a class="pp">strand-resume<span class="pc">strand<span class="dash">-</span>resume: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">strands</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;6239</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">&#95;6240</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>()
		}
	}
	<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
</span>}



<span class="comment">// ----------------------------------------------------------------------------
// Await wrappers
// ----------------------------------------------------------------------------
</span>
<span class="comment">// Convenience function for awaiting a NodeJS style callback where the first argument is a possible exception.
</span><span class="decl-fun" id="await_exn0"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await_exn0">await-exn0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) })
	} )
</span>}

<span class="comment">// Convenience function for awaiting a NodeJS style callback where the first argument is a possible exception
// and the second argument the possible result value.
</span><span class="decl-fun" id="await_exn1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await_exn1">await-exn1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">&#95;4105</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4105</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tv">&#95;4105</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4105</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4105</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4105</span></span></a>)) })
	} )
</span>}

<span class="decl-fun" id="unnull"><span class="kw">fun</span> <a class="pp" href="std_async.html#unnull">unnull<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>unnull: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">nexn</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_null"><span class="tp">null</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_exception"><span class="tp">exception</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exception: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;974</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<span class="kw">match</span>(<a class="pp">nexn<span class="pc">nexn: <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp">exception</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe_1">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">n</span> <span class="tp kw op">:</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;974</span></span></a>)
		<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>)
	}
</span>}

<span class="comment">// Convenience function for awaiting a zero argument callback.
</span><span class="decl-fun" id="await0"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await0">await0<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await0: <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
	<a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>() { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) } ); <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> } )
</span>}

<span class="comment">// Convenience function for awaiting a single argument callback.
</span><span class="decl-fun" id="await1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await1">await1<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await1: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;3945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp" href="#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3945</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">&#95;3945</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;3945</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3945</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Ok"><span class="co">Ok</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Ok: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;3945</span></span></a>)) } ); <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> } )
</span>}

<span class="comment">// Execute &#96;setup&#96; to set up an asynchronous callback with the host platform. Invoke &#96;cb&#96; as the callback:
// it takes either an exception or a result &#96;a&#96;. Usually &#96;setup&#96; returns &#96;Nothing&#96; but you can return a &#96;Just(cleanup)&#96;
// value where the &#96;cleanup&#96; functions is invoked on cancellation to dispose of any resources (see the implementation of &#96;wait&#96;).
// The callback should be invoked exactly once -- when that happens &#96;await&#96; is resumed with the result using &#96;untry&#96;
// either raise an exception or return the plain result.
</span><span class="decl-fun" id="await_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await_1">await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3922</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> <span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_exn"><span class="tp"><span class="effect">exn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp" href="#await_exn">await-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3922</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}




<span class="comment">// ----------------------------------------------------------------------------
// Async effect
// ----------------------------------------------------------------------------
</span><span class="decl-alias" id="type_space_await_result"><span class="tp kw">alias</span> <a class="pp" href="std_async.html#type_space_await_result"><span class="tp">await-result</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>result: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw">=</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a></span><span class="tp sp">&gt;</span>
<span class="decl-alias" id="type_space_await_setup"><span class="tp kw">alias</span> <a class="pp" href="std_async.html#type_space_await_setup"><span class="tp">await-setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw">=</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><span class="tp sp">&gt;</span>

<span class="comment">// Asynchronous operations have the &#96;:async&#96; effect.
</span><span class="decl-type" id="type_space_async"><span class="kw">abstract</span> <span class="tp kw">effect</span> <a class="pp" href="std_async.html#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a></span> {
	<span class="kw">fun</span> <span class="decl-fun" id="do_await"><a class="pp"><span class="tp tv">do-await</span><span class="pc">a: <span class="tp">V</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="number">23</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_await_setup"><span class="tp">await-setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a></span><span class="tp sp">&gt;</span>
	<span class="kw">fun</span> <span class="decl-fun" id="no_await"><a class="pp"><span class="tp tv">no-await</span><span class="pc">a: <span class="tp">V</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="number">30</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_await_setup"><span class="tp">await-setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a>, <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="number">30</span><span class="op">&gt;</span>) <span class="kw op">-></span> io ()</span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
	<span class="kw">fun</span> <span class="decl-fun" id="async_iox"><a class="pp"><span class="tp tv">async-iox</span><span class="pc">a: <span class="tp">V</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="number">4</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io_noexn"><span class="tp"><span class="effect">io-noexn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io<span class="dash">-</span>noexn: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> </span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>
	<span class="kw">fun</span> <span class="decl-fun" id="cancel"><a class="pp">cancel<span class="pc">cancel: <span class="tp kw op">.</span><span class="tp">op<span class="dash">-</span>cancel</span></span></a>( <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a></span><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
}


<span class="comment">// The &#96;cancel&#96; operations cancels any outstanding asynchronous operation under the innermost
// &#96;cancelable&#96; handler by returning the &#96;Cancel&#96; exception. The &#96;cancel&#96; operation itself returns normally
// without raising a &#96;Cancel&#96; exception.
</span><span class="decl-fun" id="cancel_1"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#cancel_1">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>{
	<a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a>)
</span>}

<span class="comment">// Primitive: Execute &#96;setup&#96; to set up an asynchronous callback with the host platform. Invoke &#96;cb&#96; as the callback:
// it takes either an exception or a result &#96;a&#96;. Usually &#96;setup&#96; returns &#96;Nothing&#96; but you can return a &#96;Just(cleanup)&#96;
// value where the &#96;cleanup&#96; functions is invoked on cancellation to dispose of any resources (see the implementation of &#96;wait&#96;).
// The callback should be invoked exactly once -- when that happens &#96;await-exn&#96; is resumed with the result.
</span><span class="decl-fun" id="await_exn"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await_exn">await-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#do_await">do-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>do<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<span class="kw">fun</span>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) { <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<span class="kw">fun</span>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span></span></a>) { <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3660</span><span class="tp sp">&gt;</span></span></a>,<a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>) }) }, <a class="pp" href="#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a>, <a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a> )
</span>}

<span class="comment">// Primitive: Execute &#96;setup&#96; to set up an asynchronous callback with the host platform. Invoke &#96;cb&#96; as the callback: it takes either
// an exception or a result value, together with boolean parameter whether the callback is done.
// The callback &#96;cb&#96; will eventually emit the result into the given channel &#96;ch&#96; after applying the transformation &#96;f&#96; to the result.\
// Note: once you exit the &#96;cancelable&#96; scope where &#96;await-to-channel&#96; was called, the callback is invoked with a &#96;Cancel&#96; exception.
// The channel should always be awaited within the same &#96;cancelable&#96; scope as the &#96;await-to-channel&#96; invokation.
</span><span class="decl-fun" id="await_to_channel"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#await_to_channel">await-to-channel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>to<span class="dash">-</span>channel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4396</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">&#95;4396</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">b</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a> <a class="pp" href="#type_space_channel"><span class="tp">channel</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>channel: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">b</span><span class="pc">b: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp" href="#no_await">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>no<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp sp">(</span><span class="tp tpp">cb</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>,<a class="pp" href="#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a>,<a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>) <span class="kw">fun</span>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4396</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#emit_io">emit-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>emit<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ch</span> <span class="tp kw op">:</span> <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">&#95;4396</span></span></a>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4395</span><span class="tp sp">&gt;</span></span></a>) )
	}
	<a class="pp">ch<span class="pc">ch: <span class="tp">channel</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4396</span><span class="tp sp">&gt;</span></span></a>
</span>}

<span class="decl-fun" id="async_io_noexn"><span class="kw">fun</span> <a class="pp" href="std_async.html#async_io_noexn">async-io-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;3596</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io_noexn"><span class="tp"><span class="effect">io-noexn</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io<span class="dash">-</span>noexn: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;3596</span></span></a>)
</span>}

<span class="comment">// Perform an I/O operation at the outer level; exceptions are propagated back.
</span><span class="decl-fun" id="async_io"><span class="kw">fun</span> <a class="pp" href="std_async.html#async_io">async-io<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">asyncx</span> <span class="tp tv">a</span></span></a>( <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">&#95;3613</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_asyncx"><span class="tp"><span class="effect">asyncx</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>asyncx: <span class="tp">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> {
	<a class="pp" href="#async_io_noexn">async-io-noexn<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>io<span class="dash">-</span>noexn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( { <a class="pp" href="std_core-source.html#try_1">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp tv">&#95;3613</span></span></a>) } )<span class="kw op">.</span><a class="pp" href="std_core-source.html#untry">untry<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>untry: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ex</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exn</span> <span class="tp tv">a</span></span></a>
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Async handlers: cancelable
// ----------------------------------------------------------------------------
</span>
<span class="decl-external" id="interject_async"><span class="kw">extern</span> inline <a class="pp" href="std_async.html#interject_async">interject-async<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>interject<span class="dash">-</span>async: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>( action <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_total"><span class="tp"><span class="effect">total</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>total: <span class="tp">E</span></span></a> <span class="tp sp">(</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">)</span> {
	inline <span class="st">"#1"</span>
</span>}

<span class="comment">// Execute &#96;action&#96; in a cancelable scope. If &#96;cancel&#96; is called within &#96;action&#96;,
// any outstanding asynchronous operations started in the cancelable scope are canceled.
// (Outstanding operations outside the cancelable scope are not canceled).
</span><span class="decl-fun" id="cancelable"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#cancelable">cancelable<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancelable: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span></span></a>( <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a>
{
	<span class="kw">val</span> <a class="pp">cid<span class="pc">cid: <span class="tp">int</span></span></a> <span class="kw">=</span> <a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a>{ <a class="pp" href="std_core-source.html#unique">unique<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unique: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>() }

	<span class="decl-fun" id="extend"><span class="kw">fun</span> <a class="pp">extend<span class="pc">extend: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) {
		<a class="pp" href="#parent_scope">parent-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>parent<span class="dash">-</span>scope: <span class="tp sp">(</span><span class="tp tpp">cid</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">cid<span class="pc">cid: <span class="tp">int</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)
	</span>}

	<a class="pp" href="std_core-source.html#null_const"><span class="kw">handle</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null<span class="dash">-</span>const: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>({<span class="kw">inject</span> behind<span class="op">&lt;</span><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="op">&gt;</span>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a>)}) { <a class="pp"><span class="kw">return</span><span class="pc">return: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;4534</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4534</span></span></a> <span class="kw op">-></span> {
			<span class="comment">// cancel any outstanding operations still in our scope.
</span>			<span class="comment">// this might be needed for &#96;no-await&#96; operations.
</span>			<a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a><span class="kw op">.</span><a class="pp">extend<span class="pc">extend: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>)
			<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;4534</span></span></a>
		}
		<span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">do-await<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4581</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>)	<span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4581</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a>(<a class="pp" href="#do_await">do-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>do<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4581</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a><span class="kw op">.</span><a class="pp">extend<span class="pc">extend: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>))
		<span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4733</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>,<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4733</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)	<span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a>(<a class="pp" href="#no_await">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>no<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4733</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a><span class="kw op">.</span><a class="pp">extend<span class="pc">extend: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>,<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;4733</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>))
		<span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)	<span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a>(<a class="pp" href="#cancel">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a><span class="kw op">.</span><a class="pp">extend<span class="pc">extend: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>))
		<span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;4869</span></span></a>)	<span class="kw op">-></span> <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;4869</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">|</span><span class="tp tv">&#95;4535</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;4534</span></span></a>(<a class="pp" href="#async_iox">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>iox: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">async</span> <span class="tp tv">a</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;4869</span></span></a>))
	}
</span>}

<span class="comment">// ----------------------------------------------------------------------------
// Async handle
// ----------------------------------------------------------------------------
</span>
<span class="decl-fun" id="nodispose"><span class="kw">fun</span> <a class="pp" href="std_async.html#nodispose">nodispose<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>nodispose: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {   <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a> </span>}

<span class="comment">// The outer &#96;:async&#96; effect handler. This is automatically applied by the compiler
// around the &#96;main&#96; function if it has an &#96;:async&#96; effect.
</span><span class="decl-fun" id="async_handle"><span class="kw">public</span> <span class="kw">fun</span> <a class="pp" href="std_async.html#async_handle">async-handle<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async<span class="dash">-</span>handle: <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">io</span><span class="tp sp">,</span><span class="tp">async</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">io</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space__lt__gt_"><span class="tp"><span class="effect">&lt;</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;&gt;): <span class="tp">E</span></span></a><a class="pp" href="#type_space_async"><span class="tp">async</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>async: <span class="tp">HX</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
{
	<span class="kw">val</span> <a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_ref"><span class="tp">ref</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)

	<span class="decl-fun" id="handle_await"><span class="kw">fun</span> <a class="pp">handle-await<span class="pc">handle<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_await_setup"><span class="tp">await-setup</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>await<span class="dash">-</span>setup: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>, <a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a>) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a>
	{
		<span class="kw">val</span> <a class="pp">cscope<span class="pc">cscope: <span class="tp">scope</span></span></a> <span class="kw">=</span> <a class="pp" href="#child_scope">child-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>child<span class="dash">-</span>scope: <span class="tp sp">(</span><span class="tp tpp">id</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp" href="std_core-source.html#unique">unique<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unique: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">ndet</span> <span class="tp">int</span></span></a>(),<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)
		<span class="kw">val</span> <a class="pp">dispose<span class="pc">dispose: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#ref">ref<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ref: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="#nodispose">nodispose<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>nodispose: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)

		<span class="decl-fun" id="cb"><span class="kw">fun</span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">done?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_try"><span class="tp">try</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">&#95;</span><span class="pc">&#95;(629,35): <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
			<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="#contains">contains<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>contains: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">cscope<span class="pc">cscope: <span class="tp">scope</span></span></a>)) {
				<span class="kw">if</span> (<a class="pp">done?<span class="pc">done?: <span class="tp">bool</span></span></a>) <span class="kw">then</span> {
					<a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> (<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cscope<span class="pc">cscope: <span class="tp">scope</span></span></a>)
					<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">res</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#exn_ques_">exn?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>exn?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">try</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>) <span class="kw">then</span> <a class="pp" href="std_core-source.html#try_default">try-default<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try<span class="dash">-</span>default: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">dispose<span class="pc">dispose: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
				<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
				<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">res<span class="pc">res: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span></span></a>)
			<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
		</span>}

		<span class="comment">// trace("register: " + cscope.show)
</span>		<a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">cscope<span class="pc">cscope: <span class="tp">scope</span></span></a>, <span class="kw">if</span> (<a class="pp">cancelable?<span class="pc">cancelable?: <span class="tp">bool</span></span></a>) <span class="kw">then</span> <span class="kw">fun</span>(){ <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">done?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#unsafe_cancel_exn">unsafe-cancel-exn<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>cancel<span class="dash">-</span>exn: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">exception</span></span></a>()),<a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>) } <span class="kw">else</span> <a class="pp" href="#nodispose">nodispose<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>nodispose: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>, <a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)
		<a class="pp" href="std_core-source.html#try">try<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>try: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">exn</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">hndl</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span></span></a> {
			<span class="comment">// setup the callback which returns a possible dipose function
</span>			<span class="kw">match</span>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">done?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>)) {
				<a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">d<span class="pc">d: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) <span class="kw op">-></span> <a class="pp">dispose<span class="pc">dispose: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#set"><span class="kw">:=</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>set: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <a class="pp">d<span class="pc">d: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
				<a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
			}
		}
		<span class="kw">fun</span>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>) {
			<span class="comment">// if setup fails, immediately resume with the exception
</span>			<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp tpp">res</span> <span class="tp kw op">:</span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;298</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">done?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Exn"><span class="co">Exn</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Exn: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">exception</span> <span class="tp kw op">:</span> <span class="tp">exception</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">exn<span class="pc">exn: <span class="tp">exception</span></span></a>),<a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>)
		}
	</span>}

	<span class="decl-fun" id="handle_cancel"><span class="kw">fun</span> <a class="pp">handle-cancel<span class="pc">handle<span class="dash">-</span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
		(<a class="pp" href="std_core-source.html#_excl__1">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!)<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ref</span> <span class="tp kw op">:</span> <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span> <span class="tp kw">with</span> <span class="tp">hdiv</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span></span></a><a class="pp">callbacks<span class="pc">callbacks: <span class="tp">ref</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#foreach">foreach<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>foreach: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="kw">fun</span>(<a class="pp">entry<span class="pc">entry: <span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span></span></a>) {
			<span class="kw">val</span> <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">cscope<span class="pc">cscope: <span class="tp">scope</span></span></a>,<a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a> <span class="kw">=</span> <a class="pp">entry<span class="pc">entry: <span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span></span></a>
			<span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">cscope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a><span class="kw op">.</span><a class="pp" href="#in_scope_of_ques__1">in-scope-of?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>in<span class="dash">-</span>scope<span class="dash">-</span>of?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">child</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">parent</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)) <span class="kw">then</span> <a class="pp">cb<span class="pc">cb: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
		}
	</span>}

	<a class="pp" href="std_core-source.html#null_return"><span class="kw">handle</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>null<span class="dash">-</span>return: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp">null</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">io</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>) {
		<span class="kw">control</span> raw <a class="pp">do-await<span class="pc">context: <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>, <a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a> ) { <a class="pp">handle-await<span class="pc">handle<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>, <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span></span></a>){ <a class="pp">context<span class="pc">context: <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">&lt;</span><span class="tp">async</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">file</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#resume">resume<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a>(<a class="pp">x<span class="pc">x: <span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3074</span><span class="tp sp">&gt;</span></span></a>) }, <a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>) }  <span class="comment">// returns to outer event loop
</span>    <span class="kw">control</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">no-await<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>( <a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3154</span><span class="tp sp">&gt;</span></span></a>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>, <a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>, <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3154</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> ) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">handle-await<span class="pc">handle<span class="dash">-</span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">setup</span> <span class="tp kw op">:</span> <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">,</span> <span class="tp tpp">cancelable?</span> <span class="tp kw op">:</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">setup<span class="pc">setup: <span class="tp">await<span class="dash">-</span>setup</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3154</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>,<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp">try</span><span class="tp sp">&lt;</span><span class="tp tv">&#95;3154</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>,<a class="pp">c<span class="pc">c: <span class="tp">bool</span></span></a>)) }
		<span class="kw">control</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">cancel<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>( <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> ) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">handle-cancel<span class="pc">handle<span class="dash">-</span>cancel: <span class="tp sp">(</span><span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)) }
		<span class="kw">control</span> <span class="decl-fun" id="resume_shallow"><a class="pp" href="std_core-source.html#resume">async-iox<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>resume: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">context</span> <span class="tp kw op">:</span> <span class="tp">resume<span class="dash">-</span>context</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">,</span><span class="tp tv">e1</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span></span></a></span>( <a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;3290</span></span></a> ) { <a class="pp">resume<span class="pc">resume: <span class="tp sp">(</span><span class="tp tpp">result</span> <span class="tp kw op">:</span> <span class="tp tv">&#95;3290</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<a class="pp">f<span class="pc">f: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io<span class="dash">-</span>noexn</span> <span class="tp tv">&#95;3290</span></span></a>()) }
	}
</span>}


<span class="comment">// ----------------------------------------------------------------------------
// Scope identifiers
// ----------------------------------------------------------------------------
</span>
<span class="decl-type" id="type_space_scope"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Scope"><a class="pp" href="std_async.html#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>( <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> </span></span>)

<span class="decl-val" id="empty_scope"><span class="kw">val</span> <a class="pp" href="std_async.html#empty_scope">empty-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>empty<span class="dash">-</span>scope: <span class="tp">scope</span></span></a> <span class="kw">=</span> <a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a></span>)

<span class="decl-fun" id="parent_scope"><span class="kw">fun</span> <a class="pp" href="std_async.html#parent_scope">parent-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>parent<span class="dash">-</span>scope: <span class="tp sp">(</span><span class="tp tpp">cid</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>( <a class="pp">cid<span class="pc">cid: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>) {
		<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">cid<span class="pc">cid: <span class="tp">int</span></span></a>,<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>))
	}
</span>}

<span class="decl-fun" id="child_scope"><span class="kw">fun</span> <a class="pp" href="std_async.html#child_scope">child-scope<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>child<span class="dash">-</span>scope: <span class="tp sp">(</span><span class="tp tpp">id</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>( <a class="pp">id<span class="pc">id: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>) {
		<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#_plus__4">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.4</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ys</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">[</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">id<span class="pc">id: <span class="tp">int</span></span></a><a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">]</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>)
	}
</span>}

<span class="decl-fun" id="in_scope_of_ques_"><span class="kw">fun</span> <a class="pp" href="std_async.html#in_scope_of_ques_">in-scope-of?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>in<span class="dash">-</span>scope<span class="dash">-</span>of?: <span class="tp sp">(</span><span class="tp tpp">child</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">parent</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">child<span class="pc">child: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">parent<span class="pc">parent: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">parent<span class="pc">parent: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_True"><span class="co">True</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a>,<a class="pp">ps<span class="pc">ps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp">child<span class="pc">child: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">c<span class="pc">c: <span class="tp">int</span></span></a>,<a class="pp">cs<span class="pc">cs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> (<a class="pp">c<span class="pc">c: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">p<span class="pc">p: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#in_scope_of_ques_">in-scope-of?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>in<span class="dash">-</span>scope<span class="dash">-</span>of?: <span class="tp sp">(</span><span class="tp tpp">child</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">parent</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">cs<span class="pc">cs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">ps<span class="pc">ps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>))
			<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
		}
	}
</span>}

<span class="decl-fun" id="in_scope_of_ques__1"><span class="kw">fun</span> <a class="pp" href="std_async.html#in_scope_of_ques__1">in-scope-of?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>in<span class="dash">-</span>scope<span class="dash">-</span>of?<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">child</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">parent</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">child<span class="pc">child: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">parent<span class="pc">parent: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">parent<span class="pc">parent: <span class="tp">scope</span></span></a>) {
		<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">pids<span class="pc">pids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp">child<span class="pc">child: <span class="tp">scope</span></span></a>) {
			<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#in_scope_of_ques_">in-scope-of?<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>in<span class="dash">-</span>scope<span class="dash">-</span>of?: <span class="tp sp">(</span><span class="tp tpp">child</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">parent</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">cids<span class="pc">cids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>,<a class="pp">pids<span class="pc">pids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>)
		}
	}
</span>}

<span class="decl-fun" id="_eq__eq_"><span class="kw">fun</span> <a class="pp" href="std_async.html#_eq__eq_">(==)<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">ids1</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ids2</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">ids1<span class="pc">ids1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">ids2<span class="pc">ids2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>int: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">ids1<span class="pc">ids1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) {
		<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp">ids2<span class="pc">ids2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#nil_ques_">nil?<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>nil?: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">list</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
		<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">i1<span class="pc">i1: <span class="tp">int</span></span></a>,<a class="pp">is1<span class="pc">is1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp">ids2<span class="pc">ids2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) {
			<a class="pp" href="std_core-source.html#con_space_Cons"><span class="co">Cons</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Cons: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">head</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">tail</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">i2<span class="pc">i2: <span class="tp">int</span></span></a>,<a class="pp">is2<span class="pc">is2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> (<a class="pp">i1<span class="pc">i1: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp">int</span><span class="tp sp">,</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">i2<span class="pc">i2: <span class="tp">int</span></span></a> <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">is1<span class="pc">is1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a> <a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">ids1</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ids2</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">is2<span class="pc">is2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>)
			<a class="pp" href="std_core-source.html#con_space_Nil"><span class="co">Nil</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nil: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space_False"><span class="co">False</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>False: <span class="tp">bool</span></span></a>
		}
	}
</span>}

<span class="decl-fun" id="_eq__eq__1"><span class="kw">fun</span> <a class="pp" href="std_async.html#_eq__eq__1">(==)<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">scope1</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">scope2</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">scope1<span class="pc">scope1: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">scope2<span class="pc">scope2: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">scope1<span class="pc">scope1: <span class="tp">scope</span></span></a>) {
		<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">ids1<span class="pc">ids1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <span class="kw">match</span>(<a class="pp">scope2<span class="pc">scope2: <span class="tp">scope</span></span></a>) {
			<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">ids2<span class="pc">ids2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">ids1<span class="pc">ids1: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="#_eq__eq_">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==): <span class="tp sp">(</span><span class="tp tpp">ids1</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">ids2</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a><a class="pp">ids2<span class="pc">ids2: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>
		}
	}
</span>}

<span class="decl-fun" id="_excl__eq_"><span class="kw">fun</span> <a class="pp" href="std_async.html#_excl__eq_">(!=)<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(!=): <span class="tp sp">(</span><span class="tp tpp">scope1</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">scope2</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">scope1<span class="pc">scope1: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>, <a class="pp">scope2<span class="pc">scope2: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<a class="pp" href="std_core-source.html#_excl_">!<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(!): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>(<a class="pp">scope1<span class="pc">scope1: <span class="tp">scope</span></span></a> <a class="pp" href="#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">scope1</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">scope2</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">scope2<span class="pc">scope2: <span class="tp">scope</span></span></a>)
</span>}


<span class="comment">// Convenience functions for scope maps
</span><span class="decl-fun" id="remove"><span class="kw">fun</span> <a class="pp" href="std_async.html#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;279</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;279</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#remove">remove<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>remove: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;279</span><span class="tp sp">)</span></span></a><span class="tp kw op">:</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">&#95;</span><span class="pc">&#95;(733,33): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a>) { <a class="pp">x<span class="pc">x: <span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;279</span><span class="tp sp">)</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#fst">fst<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>fst: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a> <a class="pp" href="#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">scope1</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">scope2</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> })
</span>}

<span class="decl-fun" id="lookup"><span class="kw">fun</span> <a class="pp" href="std_async.html#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;1575</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_maybe"><span class="tp">maybe</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> {
	<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;1575</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">pred</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>( <span class="kw">fun</span>(<a class="pp">x<span class="pc">x: <span class="tp">scope</span></span></a><span class="tp kw op">:</span><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a>) { <a class="pp">x<span class="pc">x: <span class="tp">scope</span></span></a> <a class="pp" href="#_eq__eq__1">==<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>(==)<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">scope1</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tpp">scope2</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> })
</span>}

<span class="decl-fun" id="contains"><span class="kw">fun</span> <a class="pp" href="std_async.html#contains">contains<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>contains: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;1709</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>list: <span class="tp">V</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool: <span class="tp">V</span></span></a> {
	<a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">&#95;1709</span><span class="tp sp">)</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#lookup">lookup<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>lookup: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp">scope</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">scope</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">scope<span class="pc">scope: <span class="tp">scope</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#bool_1">bool<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>bool<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a>
</span>}


<span class="decl-fun" id="show"><span class="kw">fun</span> <a class="pp" href="std_async.html#show">show<span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>show: <span class="tp sp">(</span><span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">scope</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>( <a class="pp">s<span class="pc">s: <span class="tp">scope</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_scope"><span class="tp">scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>scope: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
	<span class="kw">match</span>(<a class="pp">s<span class="pc">s: <span class="tp">scope</span></span></a>) {
		<a class="pp" href="#con_space_Scope"><span class="co">Scope</span><span class="pc"><span class="mo">std<span class="fslash">/</span>async<span class="fslash last">/</span></span>Scope: <span class="tp sp">(</span><span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">scope</span></span></a>(<a class="pp">ids<span class="pc">ids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a>) <span class="kw op">-></span> <a class="pp">ids<span class="pc">ids: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">int</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core-source.html#map_5">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>map<span class="postfix">.5</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">f</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">b</span><span class="tp sp">&gt;</span></span></a>(<a class="pp" href="std_core-source.html#show_1">show<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>show<span class="postfix">.1</span>: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>)<span class="kw op">.</span><a class="pp" href="std_core-source.html#join_3">join<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>join<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">sep</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a>(<span class="st">"-"</span>)
	}
</span>}
</pre>

</div></body>
</html>
