<!DOCTYPE html>
<html>
<!-- NO_CLICK_TRACKING -->

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/madoko.css" />
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>log.kk documentation</title>
</head>

<body class="koka doc body"><div class="madoko">
<pre class="koka source"><span class="comment">/&#42;---------------------------------------------------------------------------
  Copyright 2012-2016 Microsoft Corporation.
 
  This is free software; you can redistribute it and/or modify it under the
  terms of the Apache License, Version 2.0. A copy of the License can be
  found in the file "license.txt" at the root of this distribution.
---------------------------------------------------------------------------&#42;/</span>

<span class="comment">// Log messages
</span><span class="kw">public</span> <span class="kw">module</span> log 

<span class="kw">import</span> dict

<span class="decl-val" id="log_dict"><span class="kw">private</span> <span class="kw">val</span> <a class="pp" href="std_log.html#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_data_dict-source.html#type_space_mdict"><span class="tp">mdict</span><span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>mdict: <span class="tp sp">(</span><span class="tp">H</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">,</span><a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a><span class="tp sp">&gt;</span> <span class="kw">=</span> <a class="pp" href="std_core-source.html#unsafe_total">unsafe-total<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>total: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp tv">a</span></span></a> { <a class="pp" href="std_data_dict-source.html#mdict">mdict<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>mdict: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>() </span>}

<span class="comment">// Encloses a possibly total &#96;action&#96; and returns its result together
// with the contents of a log named &#96;log-name&#96;. The contents of the log
// are non-deterministically determined. However, in practice, they contain
// any messages that were recorded in the &#96;action&#96; by calls to &#96;log&#96;.
// However, if &#96;nolog&#96; was called, the log is always empty.
</span><span class="decl-fun" id="with_log"><span class="kw">fun</span> <a class="pp" href="std_log.html#with_log">with-log<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>with<span class="dash">-</span>log: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">log<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span></span></a>( <a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;781</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_ndet"><span class="tp"><span class="effect">ndet</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>ndet: <span class="tp">X</span></span></a><a class="pp" href="std_core-source.html#type_space__lt__bar__gt_"><span class="tp">|</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&lt;|&gt;): <span class="tp sp">(</span><span class="tp">X</span><span class="tp sp">,</span> <span class="tp">E</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><a class="pp"><span class="tp tv"><span class="effect">e</span></span><span class="pc">e: <span class="tp">E</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a><span class="tp sp">,</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__comma__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp sp">(</span><span class="tp">V</span><span class="tp sp">,</span> <span class="tp">V</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">V</span></span></a> {
  <a class="pp" href="std_core-source.html#unsafe_total">unsafe-total<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>total: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">val</span> <a class="pp">old-log<span class="pc">old<span class="dash">-</span>log: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a> <span class="kw">=</span> <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>]
    <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>] <span class="kw op">:=</span> <span class="st">""</span>
    <span class="kw">val</span> <a class="pp">x<span class="pc">x: <span class="tp tv">&#95;781</span></span></a> <span class="kw">=</span> <a class="pp" href="std_core-source.html#unsafe_total">unsafe-total<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>total: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp tv">a</span></span></a>(<a class="pp">action<span class="pc">action: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">ndet</span><span class="tp sp">|</span><span class="tp tv">&#95;782</span><span class="tp sp">&gt;</span> <span class="tp tv">&#95;781</span></span></a>)
    <span class="kw">val</span> <a class="pp">l<span class="pc">l: <span class="tp">string</span></span></a> <span class="kw">=</span> <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe_3">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<span class="st">""</span>)
    <span class="kw">match</span>(<a class="pp">old-log<span class="pc">old<span class="dash">-</span>log: <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a>) {
      <a class="pp" href="std_core-source.html#con_space_Nothing"><span class="co">Nothing</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Nothing: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a> <span class="kw op">-></span> <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
      <a class="pp" href="std_core-source.html#con_space_Just"><span class="co">Just</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>Just: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">value</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>(<a class="pp">old<span class="pc">old: <span class="tp">string</span></span></a>) <span class="kw op">-></span> <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>] <span class="kw op">:=</span> <a class="pp">old<span class="pc">old: <span class="tp">string</span></span></a>
    }
    <a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a><a class="pp">l<span class="pc">l: <span class="tp">string</span></span></a>,<a class="pp">x<span class="pc">x: <span class="tp tv">&#95;781</span></span></a><a class="pp" href="std_core-source.html#con_space__lp__comma__rp_"><span class="co">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(,): <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">b</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">fst</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">snd</span> <span class="tp kw op">:</span> <span class="tp tv">b</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">b</span><span class="tp sp">)</span></span></a>
  }
</span>}

<span class="comment">// Get the current log. Since this is in the &#96;io&#96; effect, &#96;with-log&#96; is preferred.
</span><span class="decl-fun" id="get_log"><span class="kw">fun</span> <a class="pp" href="std_log.html#get_log">get-log<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>get<span class="dash">-</span>log: <span class="tp sp">(</span><span class="tp tpp">log<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp">string</span></span></a>( <a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="tp">E</span></span></a> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> {
  <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe_3">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<span class="st">""</span>)
</span>}

<span class="comment">// Total fun that logs a message in a certain log &#96;log-name&#96;.
// Has no observable effect but see &#96;withLog&#96;.
</span><span class="decl-fun" id="log"><span class="kw">fun</span> <a class="pp" href="std_log.html#log">log<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log: <span class="tp sp">(</span><span class="tp tpp">log<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a>, <a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="std_core-source.html#unsafe_total">unsafe-total<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>total: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">e</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">action</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">e</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">total</span> <span class="tp tv">a</span></span></a> {
    <span class="kw">if</span> (<a class="pp" href="std_core-source.html#con_space_True"><span class="co">!</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>True: <span class="tp">bool</span></span></a>(<a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_data_dict-source.html#contains_key">contains-key<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>contains<span class="dash">-</span>key: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">bool</span></span></a>(<span class="st">"nolog"</span>)) <a class="pp" href="std_core-source.html#_amp__amp_">&amp;&amp;<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(&amp;&amp;): <span class="tp sp">(</span><span class="tp">bool</span><span class="tp sp">,</span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span></span></a> <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_data_dict-source.html#contains_key">contains-key<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>contains<span class="dash">-</span>key: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">bool</span></span></a>(<a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>)) {
      <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>] <span class="kw op">:=</span> <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_index_">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a><a class="pp">log-name<span class="pc">log<span class="dash">-</span>name: <span class="tp">string</span></span></a>]<span class="kw op">.</span><a class="pp" href="std_core-source.html#maybe_3">maybe<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>maybe<span class="postfix">.3</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">m</span> <span class="tp kw op">:</span> <span class="tp">maybe</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">nothing</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span></span></a>(<span class="st">""</span>) <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> (<a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a> <a class="pp" href="std_core-source.html#_plus__3">+<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(+)<span class="postfix">.3</span>: <span class="tp sp">(</span><span class="tp">string</span><span class="tp sp">,</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">string</span></span></a> <span class="st">"\n"</span>)      
    <a class="pp" href="std_core-source.html#con_space__lp__rp_"><span class="co">}</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp sp">(</span><span class="tp sp">)</span></span></a>
  }
</span>}

<span class="comment">// Disable logging completely.
</span><span class="decl-fun" id="nolog"><span class="kw">fun</span> <a class="pp" href="std_log.html#nolog">nolog<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>nolog: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">st</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>() <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_st"><span class="tp">st</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>st: <span class="tp">H</span> <span class="tp kw op">-></span> <span class="tp">E</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="std_core-source.html#type_space_global"><span class="tp">global</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>global: <span class="tp">H</span></span></a><span class="tp sp">&gt;</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#log_dict">log-dict<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>dict: <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">,</span><span class="tp">string</span><span class="tp sp">&gt;</span></span></a><a class="pp" href="std_data_dict-source.html#_lb__rb__1">[<span class="pc"><span class="mo">std<span class="fslash">/</span>data<span class="fslash">/</span>dict<span class="fslash last">/</span></span>[]<span class="postfix">.1</span>: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">,</span><span class="tp tv">h</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">md</span> <span class="tp kw op">:</span> <span class="tp">mdict</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">,</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">s</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">assigned</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp tv">h</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a><span class="st">"nolog"</span>] <span class="kw op">:=</span> <span class="st">""</span>
</span>}


<span class="comment">// Log an error (to log &#96;"error"&#96;). This should be used in particular
// to log errors in pure functions that are otherwise ignored.
</span><span class="decl-fun" id="log_error"><span class="kw">fun</span> <a class="pp" href="std_log.html#log_error">log-error<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>error: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#log">log<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log: <span class="tp sp">(</span><span class="tp tpp">log<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"error"</span>, <a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a>)
</span>}

<span class="comment">// Log a warning (to log &#96;"warning"&#96;). This should be used in particular
// to log warnings in pure functions that are otherwise ignored.
</span><span class="decl-fun" id="log_warning"><span class="kw">fun</span> <a class="pp" href="std_log.html#log_warning">log-warning<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log<span class="dash">-</span>warning: <span class="tp sp">(</span><span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_string"><span class="tp">string</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>string: <span class="tp">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a><a class="pp" href="std_core-source.html#type_space__lp__rp_"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>(): <span class="tp">V</span></span></a> {
  <a class="pp" href="#log">log<span class="pc"><span class="mo">std<span class="fslash">/</span>log<span class="fslash last">/</span></span>log: <span class="tp sp">(</span><span class="tp tpp">log<span class="dash">-</span>name</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">,</span> <span class="tp tpp">message</span> <span class="tp kw op">:</span> <span class="tp">string</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>(<span class="st">"warning"</span>, <a class="pp">message<span class="pc">message: <span class="tp">string</span></span></a>)
</span>}</pre>

</div></body>
</html>
